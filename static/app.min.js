"use strict";class TextBar{constructor(element){this.textBarElement=element,element.querySelector("i").addEventListener("click",()=>this.hide()),this.textBarText=element.querySelector("p")}show(text,time){this.textBarText.innerText=text,this.textBarElement.classList.add("show"),time&&setTimeout(()=>this.hide(),time)}hide(){this.textBarText.innerText="",this.textBarElement.classList.remove("show")}}class PastedDocument{constructor(pasteServer){this.pasteServer=pasteServer,this.locked=!1,this.key=null}async load(key){try{const response=await fetch("/documents/"+key,{method:"GET"});if(response.ok){const documentText=(await response.json()).text;NodeJSPasteServer.showElement(this.pasteServer.codeBox,!0),NodeJSPasteServer.showElement(this.pasteServer.textArea,!1),document.title=key+" - NodeJS-PasteServer",this.pasteServer.updateCodeLines(documentText.split("\n").length),this.pasteServer.code.innerHTML=hljs.highlightAuto(documentText).value,this.pasteServer.textArea.readOnly=!0,this.locked=!0,this.key=key}else window.location.href=window.location.href.split(key)[0]}catch(error){console.error("Error while loading document: ",error)}}async save(text){if(""!==text.trim()&&!this.locked)try{const response=await fetch("/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:text}),json=await response.json();if(response.ok){const key=json.key;window.history.pushState({},"NodeJS-PasteServer","/"+key),await this.load(key),this.pasteServer.textBar.show("Secret to delete paste: "+json.deleteSecret)}else if(json.message){const message=json.message;this.pasteServer.textBar.show("Error while saving: "+message,3e3)}else this.pasteServer.textBar.show("Unexpected error occurred while saving",3e3)}catch(error){console.error("Error while saving document: ",error)}}async delete(secret){if(this.key&&this.locked)try{const response=await fetch(`/documents/delete/${this.key}/${secret}`,{method:"GET"}),json=await response.json();if(response.ok)window.location.href=window.location.href.split(self.key)[0];else if(json.message){const message=json.message;this.pasteServer.textBar.show("Failed to delete document: "+message,3e3)}else this.pasteServer.textBar.show("Unexpected error occurred while deleting",3e3)}catch(error){console.error("Error while deleting document: ",error)}}}class NodeJSPasteServer{static showElement(element,show){show?element.classList.remove("invisible"):element.classList.add("invisible")}constructor(){this.codeBox=document.getElementById("codeBox"),this.codeBoxLines=this.codeBox.querySelector(".codeLines"),this.code=this.codeBox.querySelector("code"),NodeJSPasteServer.showElement(this.codeBox,!1),this.textArea=document.querySelector("textarea"),this.textBar=new TextBar(document.querySelector(".textBar")),this.textArea.select(),this.currentDocument=new PastedDocument(this),this.setupShortcuts(),this.setupButtons(),this.setupModals()}async readURL(){const url=window.location.href.split("/");if(url.length>3){const key=url[3];""!==key.trim()&&await this.currentDocument.load(key)}}setupShortcuts(){document.addEventListener("keydown",async keyDownEvent=>{if(keyDownEvent.ctrlKey)switch(keyDownEvent.code){case"KeyS":keyDownEvent.preventDefault(),await this.currentDocument.save(this.textArea.value);break;case"KeyN":keyDownEvent.preventDefault();const url=window.location.href.split("/");url.length>2&&(window.location.href="http://"+url[2]);break;case"KeyD":keyDownEvent.preventDefault(),this.currentDocument.locked&&this.deleteModal.open();break;case"KeyC":keyDownEvent.altKey&&(keyDownEvent.preventDefault(),this.copyToClipboard())}})}setupButtons(){document.getElementById("saveButton").addEventListener("click",async()=>await this.currentDocument.save(this.textArea.value)),document.getElementById("copyButton").addEventListener("click",()=>this.copyToClipboard()),document.getElementById("newDocButton").addEventListener("click",()=>{const url=window.location.href.split("/");url.length>2&&(window.location.href="http://"+url[2])}),document.getElementById("deleteButton").addEventListener("click",()=>{this.currentDocument.locked&&this.deleteModal.open()});const sidePanel=document.querySelector(".side-panel");document.querySelector(".collapse-button").addEventListener("click",()=>{sidePanel.classList.contains("collapsed")?sidePanel.classList.remove("collapsed"):sidePanel.classList.add("collapsed")})}setupModals(){M.Modal.init(document.querySelectorAll(".modal"),{}),this.deleteModal=M.Modal.getInstance(document.getElementById("deleteModal")),this.deleteModal.options.onCloseEnd=()=>{this.deleteSecretInput.value="",this.deleteSecretInput.nextElementSibling.classList.remove("active")},this.deleteSecretInput=document.getElementById("deleteSecretInput"),document.getElementById("modalDeleteButton").addEventListener("click",async()=>await this.currentDocument.delete(this.deleteSecretInput.value))}copyToClipboard(){if(this.currentDocument.locked){if(document.selection){const range=document.body.createTextRange();range.moveToElementText(this.code),range.select()}else if(window.getSelection){const range=document.createRange();range.selectNode(this.code),window.getSelection().removeAllRanges(),window.getSelection().addRange(range)}}else this.textArea.select();document.execCommand("copy")}updateCodeLines(lineCount){const codeLines=this.codeBoxLines;for(;codeLines.firstChild;)codeLines.removeChild(codeLines.firstChild);for(let i=1;i<lineCount+1;i++){const lineTextNode=document.createTextNode(i.toString()),lineBreakElement=document.createElement("br");codeLines.appendChild(lineTextNode),codeLines.appendChild(lineBreakElement)}}}document.addEventListener("DOMContentLoaded",async()=>{const version=await(await fetch("/version/",{method:"GET"})).text();document.querySelector(".version").innerHTML=version,await(new NodeJSPasteServer).readURL()});